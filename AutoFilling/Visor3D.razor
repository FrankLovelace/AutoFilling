@page "/visor3d"
@using Microsoft.JSInterop
@inject IJSRuntime JS

<div class="visor-3d-wrapper">
    <canvas id="mockCanvas"></canvas>
    
    <div class="overlay-info">
        <h3>Visor 3D (Receptor)</h3>
        <p>Esperando datos del editor...</p>
    </div>
</div>

<style>
    .visor-3d-wrapper { 
        position: relative; 
        width: 100%; 
        height: 100vh; 
        background-color: #333; 
        overflow: hidden;
    }
    #mockCanvas { 
        width: 100%; 
        height: 100%; 
        display: block; 
    }
    .overlay-info {
        position: absolute; top: 10px; left: 10px;
        background: rgba(255,255,255,0.8);
        padding: 10px; border-radius: 5px;
        pointer-events: none; 
    }
</style>

@code {
    private IJSObjectReference? module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try 
            {
                module = await JS.InvokeAsync<IJSObjectReference>("import", "./_content/AutoFilling/js/visorMock.js");
                await module.InvokeVoidAsync("init", "mockCanvas");
                await module.InvokeVoidAsync("iniciarEscucha");
            }
            catch (Exception ex)
            {
                Console.WriteLine("⚠️ ERROR CARGANDO JS EN VISOR: " + ex.Message);
            }
        }
    }
}